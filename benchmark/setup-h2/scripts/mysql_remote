
####FUNCTIONS####
setupPaswordless() {
echo "Setting passwordless shh to $1" 
expect <<EOD
spawn ssh-copy-id root@$1
expect "*you want to continue*"
send -- "yes\r"
expect "*?assword:*"
send -- "$2\r"
expect eof
EOD
}
#######

echo "Installing expect"
yum -y -q install expect

echo "Creating ssh key" 
ssh-keygen -t rsa -P "" -f "/root/.ssh/id_rsa"
setupPaswordless MYSQL_MGMD_IP_1 $PASSWORD
setupPaswordless MYSQL_MGMD_IP_2 $PASSWORD  
setupPaswordless MYSQL_API_NODE_LOCAL_IP_1 $PASSWORD
setupPaswordless MYSQL_API_NODE_LOCAL_IP_2 $PASSWORD
setupPaswordless MYSQL_DATA_NODE_LOCAL_IP_1 $PASSWORD
setupPaswordless MYSQL_DATA_NODE_LOCAL_IP_2 $PASSWORD

service iptables stop 
chkconfig iptables off 

cd /opt/mysqlcluster-73-rpm/cluster/scripts/install
./deploy.sh 2>&1
